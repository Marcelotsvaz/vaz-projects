# 
# VAZ Projects
# 
# 
# Author: Marcelo Tellier Sartori Vaz <marcelotsvaz@gmail.com>



# 
# Jobs.
#-----------------------------------------------------------------------------------------------------------------------
.deploy:
    environment:
        action: start
    
    image:
        name: hashicorp/terraform:1.2.5
        entrypoint: [ '' ]
    
    cache:
        paths: [ deployment/terraform/ ]
    
    script:
      - apk add --no-cache bash tar
      - deploy/deploy.sh deployEnvironment ${CI_ENVIRONMENT_TIER}
      - cp deployment/vazProjects-${CI_ENVIRONMENT_TIER}/application/environment.env deployment/applicationEnvironment.env
    
    artifacts:
        paths:
          - deployment/applicationEnvironment.env
        reports:
            terraform: deployment/terraformChanges.json
        name: ${CI_ENVIRONMENT_TIER}